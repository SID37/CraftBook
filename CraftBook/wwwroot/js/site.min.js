var IngredientSoul=function(){},IngredientView=function(e){var t=this;this.delete=function(){t.button.onclick(null)},this.main=document.createElement("div"),this.main.classList.add("fieldform"),this.main.innerHTML='<div class="in-frame"><input type="text" name="name" readonly /><input type="number" name="volume" readonly /><input type="text" name="unit" readonly /></div><input type="image" name="del_ingredient" src="/images/close.svg" />',this.button=this.main.querySelector('input[type="image"'),this.button.onclick=function(){return t.main.remove(),t.ondeleted(t),!1},this.name=this.main.querySelector('input[name="name"]'),this.unit=this.main.querySelector('input[name="unit"]'),this.volume=this.main.querySelector('input[name="volume"]'),this.name.value=e.name,this.volume.value=e.quantity.toString(),this.unit.value=e.unitShortName},ListIngredients=function(){function e(e){var r=this;this.key="listIngredient",this.addIngredient=function(e){var t=JSON.parse(e),n=r.models.filter(function(e){return e.id===t.id});if(null!=n&&0!==n.length){var i=r.models.lastIndexOf(n[0]);r.views[i].delete()}var o=r.models.length;r.models[o]=t,r.addView()(r.models[o],o,r.models)},this.headNode=e,this.models=JSON.parse(localStorage.getItem(this.key)),this.views=new Array,null==this.models?this.models=new Array:this.models.forEach(this.addView()),window.addEventListener("unload",function(){localStorage.setItem(r.key,JSON.stringify(r.models))}),this.headNode.onsubmit=function(){return r.onshearch(r.models),!1}}return e.prototype.addView=function(){var n=this;return function(e,t){n.views[t]=new IngredientView(e),n.views[t].ondeleted=function(e){var t=n.views.lastIndexOf(e);n.models.splice(t,1),n.views.splice(t,1)},n.headNode.appendChild(n.views[t].main)}},e}(),SearchString=function(){var t=this;this.form=document.querySelector('form[action="/Recipes/SearchByString"'),this.data=this.form.querySelector('input[name="searchString"]'),this.form.onsubmit=function(){var e=t.data.value;return e&&t.onshearch(e),!1}},ListRecipesButton=function(e){var t=this;this.btn=e,"currentPage"!==this.btn.id&&(this.btn.onclick=function(e){t.onclick(parseInt(t.btn.textContent))})},ListRecipes=function(){function e(e){this.headNode=e}return e.prototype.search=function(t,e){var n=this;void 0===e&&(e=1);var i=new XMLHttpRequest;if(i.onloadend=function(){if(404!==i.status){for(;n.headNode.hasChildNodes();)n.headNode.removeChild(n.headNode.firstChild);n.headNode.insertAdjacentHTML("beforeend",i.response),n.headNode.querySelectorAll(".page").forEach(function(e){new ListRecipesButton(e).onclick=function(e){n.search(t,e)}})}},"string"==typeof t){var o=t;i.open("POST","/Recipes/SearchByString",!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send("searchString="+encodeURIComponent(o)+"&pageNumber="+e)}else if("object"==typeof t){var r=t;i.open("POST","/Recipes/SearchByIngredients",!0),i.setRequestHeader("Content-Type","application/json");var s={ingredients:r,pageNumber:e};i.send(JSON.stringify(s))}},e}(),IngredientAddatorView=function(){var o=this;this.name=document.querySelector('article.inventory input[type="text"]'),this.btnAdd=document.getElementById("buttonAddIngridient"),this.count=document.querySelector('article.inventory input[type="number"]'),this.unit=document.querySelector('article.inventory input[name="ingredient_unit"]'),this.form=document.querySelector("article.inventory form.add-ingredient"),this.name.addEventListener("input",function(){var e=o.name.value;if(console.log(e),0!==e.length&&!document.querySelector('option[value="'+e+'"')){var t=new XMLHttpRequest;t.open("POST","/Ingredients/Index",!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onloadend=function(){if(404!==t.status){var e=document.querySelector('datalist[id="ingredients"');null!=e&&e.parentNode.removeChild(e),o.form.insertAdjacentHTML("afterend",t.response)}},t.send("nameChip="+encodeURIComponent(e))}}),this.name.addEventListener("change",function(){var e=o.name.value,t=document.querySelector('option[value="'+e+'"');o.btnAdd.style.visibility=null==t?(o.unit.value=null,"hidden"):(o.unit.value=t.getAttribute("label"),"visible")}),this.form.onsubmit=function(e){try{if(""===o.unit.value)return!1;var t=new XMLHttpRequest;t.open("POST","/IngredientQuant/FindName",!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onloadend=function(){404!==t.status?(o.onadded(t.response),o.count.value=null,o.name.value=null,o.unit.value=null):alert("ингредиент не найден!")};var n=o.name.value,i=o.count.value;t.send("ingredientName="+encodeURIComponent(n)+"&volume="+encodeURIComponent(i))}catch(e){return console.log(e.toString()),!1}return!1}},Inventory=function(){var t=this;this.addator=new IngredientAddatorView,this.listIngridients=new ListIngredients(document.querySelector("article.inventory form.list-ingredients")),this.listRecipes=new ListRecipes(document.querySelector("article.recipe_list")),this.listRecipes.search(""),this.listIngridients.onshearch=function(e){t.listRecipes.search(e)},(new SearchString).onshearch=function(e){t.listRecipes.search(e)},this.addator.onadded=this.listIngridients.addIngredient},inventory=new Inventory;