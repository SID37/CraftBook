var IngredientSoul=function(){},IngredientView=function(e){var n=this;this.main=document.createElement("div"),this.main.classList.add("fieldform"),this.main.innerHTML='<div class="in-frame"><input type="text" name="name" readonly /><input type="number" name="volume" readonly /><input type="text" name="unit" readonly /></div><input type="image" name="del_ingredient" src="/images/close.svg" />',this.button=this.main.querySelector('input[type="image"'),this.button.onclick=function(){return n.main.remove(),n.ondeleted(n),!1},this.name=this.main.querySelector('input[name="name"]'),this.unit=this.main.querySelector('input[name="unit"]'),this.volume=this.main.querySelector('input[name="volume"]'),this.name.value=e.name,this.volume.value=e.quantity.toString(),this.unit.value=e.unitShortName},ListIngredients=function(){function e(e){var o=this;this.key="listIngredient",this.addIngredient=function(e){var n=JSON.parse(e),t=o.models.filter(function(e){return e.id===n.id});if(null!=t&&0!==t.length){var i=o.models.lastIndexOf(t[0]);o.views[i].button.onclick(null)}var r=o.models.length;o.models[r]=n,o.addView()(o.models[r],r,o.models)},this.headNode=e,this.models=JSON.parse(localStorage.getItem(this.key)),this.views=new Array,null==this.models?this.models=new Array:this.models.forEach(this.addView()),window.addEventListener("unload",function(){localStorage.setItem(o.key,JSON.stringify(o.models))}),this.headNode.onsubmit=function(){return o.onshearch(o.models),!1}}return e.prototype.addView=function(){var t=this;return function(e,n){t.views[n]=new IngredientView(e),t.views[n].ondeleted=function(e){var n=t.views.lastIndexOf(e);t.models.splice(n,1),t.views.splice(n,1)},t.headNode.appendChild(t.views[n].main)}},e}(),SearchString=function(){var n=this;this.form=document.querySelector('form[action="/Recipes/SearchByString"'),this.data=this.form.querySelector('input[name="searchString"]'),this.form.onsubmit=function(){var e=n.data.value;return e&&n.onshearch(e),!1}},ListRecipes=function(){function e(e){this.headNode=e}return e.prototype.search=function(e){var n=this,t=new XMLHttpRequest;t.open("POST","/Recipes/SearchByIngredients",!0),t.setRequestHeader("Content-Type","application/json"),t.onloadend=function(){if(404!==t.status){for(;n.headNode.hasChildNodes();)n.headNode.removeChild(n.headNode.firstChild);n.headNode.insertAdjacentHTML("beforeend",t.response)}};var i={ingredients:e,pageNumber:1};t.send(JSON.stringify(i))},e.prototype.searchByString=function(e){var n=this,t=new XMLHttpRequest;t.open("POST","/Recipes/SearchByString",!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onloadend=function(){if(404!==t.status){for(;n.headNode.hasChildNodes();)n.headNode.removeChild(n.headNode.firstChild);n.headNode.insertAdjacentHTML("beforeend",t.response)}},t.send("searchString="+encodeURIComponent(e)+"&pageNumber=1")},e}(),Inventory=function(){var r=this;this.inputNameIngr=document.querySelector('article.inventory input[type="text"]'),this.inputButton=document.getElementById("buttonAddIngridient"),this.inputCountIngr=document.querySelector('article.inventory input[type="number"]'),this.inputUIIngr=document.querySelector('article.inventory input[name="ingredient_unit"]'),this.form=document.querySelector("article.inventory form.add-ingredient"),this.listIngridients=new ListIngredients(document.querySelector("article.inventory form.list-ingredients")),this.listRecipes=new ListRecipes(document.querySelector("article.recipe_list")),this.listIngridients.onshearch=function(e){r.listRecipes.search(e)},(new SearchString).onshearch=function(e){r.listRecipes.searchByString(e)},this.inputNameIngr.addEventListener("input",function(){var e=r.inputNameIngr.value;if(console.log(e),0!==e.length&&!document.querySelector('option[value="'+e+'"')){var n=new XMLHttpRequest;n.open("POST","/Ingredients/Index",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onloadend=function(){if(404!==n.status){var e=document.querySelector('datalist[id="ingredients"');null!=e&&e.parentNode.removeChild(e),r.form.insertAdjacentHTML("afterend",n.response)}},n.send("nameChip="+encodeURIComponent(e))}}),this.inputNameIngr.addEventListener("change",function(){var e=r.inputNameIngr.value,n=document.querySelector('option[value="'+e+'"');r.inputButton.style.visibility=null==n?(r.inputUIIngr.value=null,"hidden"):(r.inputUIIngr.value=n.getAttribute("label"),"visible")}),this.form.onsubmit=function(e){try{if(""===r.inputUIIngr.value)return!1;var n=new XMLHttpRequest;n.open("POST","/IngredientQuant/FindName",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onloadend=function(){404!==n.status?(r.listIngridients.addIngredient(n.response),r.inputCountIngr.value=null,r.inputNameIngr.value=null,r.inputUIIngr.value=null):alert("ингредиент не найден!")};var t=r.inputNameIngr.value,i=r.inputCountIngr.value;n.send("ingredientName="+encodeURIComponent(t)+"&volume="+encodeURIComponent(i))}catch(e){return console.log(e.toString()),!1}return!1}},inventory=new Inventory;